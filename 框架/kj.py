# @author:九世
# @time:2019/5/11
# @file:kj.py

import os
from lib import data
from lib import use_data
import sys

sys.dont_write_bytecode=True

class Kuanjia:
    def __init__(self):
        hostname='kj'
        command_list={'exec':data.exec,'help':data.help,'use':data.use,'version':data.version,'search':data.search,'exit':data.exit}
        use_list={'back':use_data.back,'set':use_data.set,'unset':use_data.unset,'show_options':use_data.show_options,'run':use_data.run,'info':use_data.info,'helps':use_data.helps}
        banner='''
                                            .__          
  ____ ___  ________    _____ ______ |  |   ____  
_/ __ \\  \/  /\__  \  /     \\____ \|  | _/ __ \ 
\  ___/ >    <  / __ \|  Y Y  \  |_> >  |_\  ___/ 
 \___  >__/\_ \(____  /__|_|  /   __/|____/\___  >
     \/      \/     \/      \/|__|             \/ 
        
        exploit:{} 个
        auxiliary:{} 个
        
        version:0.0.1
        author:九世
        github:https://github.com/422926799
        '''.format(self.tonji()['exploit'],self.tonji()['auxiliary'])
        print(banner)

        raw_prompt_default_template = "\033[4;31m {} \033[0m> ".format(hostname)
        default=[]
        while True:
            user=input(raw_prompt_default_template).split(' ')
            if user[0]=='use':
                if len(default)>0:
                    default.clear()
                uk=command_list[user[0]](user[1])
                if uk==0:
                    pass
                else:
                    default.append(uk[0])
                    raw_prompt_default_template = "\033[4;31m {} \033[0m> ".format(uk[1])


            elif user[0]=='exec':
                command_list[user[0]](user[1])

            elif user[0]=='search':
                command_list[user[0]](user[1])

            elif user[0]=='exit':
                command_list[user[0]]()
                exit()

            elif user[0] in  command_list:
                command_list[user[0]]()

            elif user[0]=='back':
                if len(default)>0:
                    default.clear()
                    raw_prompt_default_template =use_list[user[0]]()
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='show_options':
                if len(default) > 0:
                    use_list[user[0]](default[0])
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='set':
                if len(default)>0:
                    try:
                        use_list[user[0]](default[0],user[1],user[2])
                    except:
                        print('[-] 模块没有这个选择')
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='unset':
                if len(default)>0:
                    use_list[user[0]](default[0],user[1])
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='info':
                if len(default)>0:
                    use_list[user[0]](default[0])
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='helps':
                if len(default)>0:
                    use_list[user[0]]()
                else:
                    print('[-] 并没有选择模块')

            elif user[0]=='run':
                if len(default)>0:
                    use_list[user[0]](default[0])
                else:
                    print('[-] 并没有选择模块')

            else:
                print('[-] 没有这个选项')


    def tonji(self):
        exploit_tj=os.listdir('plugin/exploit')
        auxiliary_tj=os.listdir('plugin/auxiliary')
        jg={'exploit':len(exploit_tj),'auxiliary':len(auxiliary_tj)}
        return jg
if __name__ == '__main__':
    obj=Kuanjia()